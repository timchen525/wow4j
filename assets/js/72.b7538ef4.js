(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{546:function(_,v,t){"use strict";t.r(v);var a=t(19),r=Object(a.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("p",[_._v("这里以 CRM 项目的用户触达模块为例，给大家分享一下。")]),_._v(" "),t("h1",{attrs:{id:"crm-技术设计文档「消息触达模块」"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crm-技术设计文档「消息触达模块」"}},[_._v("#")]),_._v(" CRM 技术设计文档「消息触达模块」")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("项目名称")]),_._v(" "),t("th",[_._v("CRM 系统")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("项目负责人")]),_._v(" "),t("td",[t("code",[_._v("@张三")])])]),_._v(" "),t("tr",[t("td",[_._v("模块名称")]),_._v(" "),t("td",[_._v("用户触达模块")])]),_._v(" "),t("tr",[t("td",[_._v("模块负责人")]),_._v(" "),t("td",[t("code",[_._v("@李四")])])])])]),_._v(" "),t("h2",{attrs:{id:"_1-修订记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-修订记录"}},[_._v("#")]),_._v(" 1. 修订记录")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("版本")]),_._v(" "),t("th",[_._v("修订人")]),_._v(" "),t("th",[_._v("修订内容")]),_._v(" "),t("th",[_._v("修订日期")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("v1.0")]),_._v(" "),t("td",[t("code",[_._v("@张三")])]),_._v(" "),t("td",[_._v("创建")]),_._v(" "),t("td",[_._v("2022-12-23")])])])]),_._v(" "),t("h2",{attrs:{id:"_2-需求-背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-需求-背景"}},[_._v("#")]),_._v(" 2. 需求/背景")]),_._v(" "),t("p",[_._v("产品文档：xxx")]),_._v(" "),t("p",[_._v("为了实现用户的精细化运营，通过多种途径，向用户发送消息通知……")]),_._v(" "),t("h2",{attrs:{id:"_3-设计目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-设计目标"}},[_._v("#")]),_._v(" 3. 设计目标")]),_._v(" "),t("h3",{attrs:{id:"_3-1-实现功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-实现功能"}},[_._v("#")]),_._v(" 3.1 实现功能")]),_._v(" "),t("ol",[t("li",[_._v("多种渠道给用户推送消息，主要包含站内和站外两大部分：")])]),_._v(" "),t("ul",[t("li",[_._v("站内：\n"),t("ul",[t("li",[_._v("站内信")]),_._v(" "),t("li",[_._v("弹屏")])])]),_._v(" "),t("li",[_._v("站外\n"),t("ul",[t("li",[_._v("邮箱")]),_._v(" "),t("li",[_._v("短信")]),_._v(" "),t("li",[_._v("push")]),_._v(" "),t("li",[_._v("微信")]),_._v(" "),t("li",[_._v("……")])])])]),_._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[_._v("触达任务")])]),_._v(" "),t("ul",[t("li",[_._v("支持定时/延时消息发送")]),_._v(" "),t("li",[_._v("支持触发型消息发送")]),_._v(" "),t("li",[_._v("支持用户分群发送")])]),_._v(" "),t("blockquote",[t("p",[_._v("功能点比较多的话，可以用思维导图的形式来整理。")])]),_._v(" "),t("h3",{attrs:{id:"_3-2-设计指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-设计指标"}},[_._v("#")]),_._v(" 3.2 设计指标")]),_._v(" "),t("ol",[t("li",[_._v("性能指标")])]),_._v(" "),t("ul",[t("li",[_._v("百万级消息分钟级发送完成")]),_._v(" "),t("li",[_._v("xx接口，性能指标：单机 1000 并发，95%响应 <= 200ms")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[_._v("可用性")])]),_._v(" "),t("ul",[t("li",[_._v("触达模块 99.9% 可用")]),_._v(" "),t("li",[_._v("消息推送成功率 80% 以上")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[_._v("扩展性")])]),_._v(" "),t("ul",[t("li",[_._v("采用策略模式+配置，新增消息渠道，只需少量代码+代码即可实现。")]),_._v(" "),t("li",[_._v("引入规则引擎，统一消息类型的不同渠道，可以通过规则调整，无需发版。")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[_._v("兼容性")])]),_._v(" "),t("ul",[t("li",[_._v("接口xxx向前兼容 APP 1.9.0 版本，低版本需强制更新。")])]),_._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[_._v("可观测性")])]),_._v(" "),t("ul",[t("li",[_._v("接入 Prometheus 和 Grafana，对服务和业务进行监控\n"),t("ul",[t("li",[_._v("服务监控：通过控制面板观察服务的内存、CPU、JVM、接口 QPS、接口 RT ……\n= 业务监控：通过埋点上报，收集用户触达数据，通过面板可以分设备、渠道查看用户触达成功率 ……")])])])]),_._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[_._v("告警")])]),_._v(" "),t("ul",[t("li",[_._v("通过 Prometheus Alert 实现服务的告警，告警信息分级别，进行飞书通知、电话通知、告警类型分为服务告警和业务告警。\n"),t("ul",[t("li",[_._v("服务告警：内存、CPU 占用过高、接口 QPS 过高、接口 RT 过长，触发告警")]),_._v(" "),t("li",[_._v("业务告警：用户触达成功率过低告警")])])])]),_._v(" "),t("h2",{attrs:{id:"_4-概要设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-概要设计"}},[_._v("#")]),_._v(" 4. 概要设计")]),_._v(" "),t("h3",{attrs:{id:"_4-1-设计思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-设计思路"}},[_._v("#")]),_._v(" 4.1 设计思路")]),_._v(" "),t("ul",[t("li",[_._v("数百万消息短时间发送完成，流量较大，对数据存储性能要求较高，需要选用高性能 DB，对存储压力也比较大，同时需要一定削峰处理。")]),_._v(" "),t("li",[_._v("定时/延时消息发送采用消息队列完成，对 MQ 的消费要求较高，并发度要高，批量消费。")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("h3",{attrs:{id:"_4-2-技术选型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-技术选型"}},[_._v("#")]),_._v(" 4.2 技术选型")]),_._v(" "),t("ul",[t("li",[_._v("存储：TiDB")]),_._v(" "),t("li",[_._v("缓存：Redis")]),_._v(" "),t("li",[_._v("消息队列：业务 RocketMQ、埋点 Kafka")]),_._v(" "),t("li",[_._v("注册中心：Nacos")]),_._v(" "),t("li",[_._v("配置中心：Nacos")]),_._v(" "),t("li",[_._v("RPC：Dubbo")]),_._v(" "),t("li",[_._v("网关：Gateway")]),_._v(" "),t("li",[_._v("Push通道：自建")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("h3",{attrs:{id:"_4-3-业务架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-业务架构"}},[_._v("#")]),_._v(" 4.3 业务架构")]),_._v(" "),t("p",[_._v("待补充")]),_._v(" "),t("h3",{attrs:{id:"_4-4-技术架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-技术架构"}},[_._v("#")]),_._v(" 4.4 技术架构")]),_._v(" "),t("p",[_._v("待补充")]),_._v(" "),t("h3",{attrs:{id:"_4-5-系统环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-系统环境"}},[_._v("#")]),_._v(" 4.5 系统环境")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("JDK 版本：11")])]),_._v(" "),t("li",[t("p",[_._v("部署环境：k8s + Container，单 pod 8 核 CPU + 4G 内存，服务集群 32 个 pod")])]),_._v(" "),t("li",[t("p",[_._v("数据库")]),_._v(" "),t("ul",[t("li",[_._v("业务数据：TiDB 64核 CPU + 128G 内存")]),_._v(" "),t("li",[_._v("离线数据：Hbase ……")]),_._v(" "),t("li",[_._v("……")])])]),_._v(" "),t("li",[t("p",[_._v("……")])])]),_._v(" "),t("h2",{attrs:{id:"_5-详细设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-详细设计"}},[_._v("#")]),_._v(" 5. 详细设计")]),_._v(" "),t("blockquote",[t("p",[_._v("详细设计，是具体指导开发的设计部分，包括：流程、数据模型、算法、客户端的接口等等。")])]),_._v(" "),t("h3",{attrs:{id:"_5-1-流程设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-流程设计"}},[_._v("#")]),_._v(" 5.1 流程设计")]),_._v(" "),t("ul",[t("li",[_._v("push 流程")])]),_._v(" "),t("p",[_._v("待补充")]),_._v(" "),t("ul",[t("li",[_._v("Alipay 接入时序图")])]),_._v(" "),t("p",[_._v("待补充")]),_._v(" "),t("h3",{attrs:{id:"_5-2-算法设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-算法设计"}},[_._v("#")]),_._v(" 5.2 算法设计")]),_._v(" "),t("ul",[t("li",[_._v("渠道分流：同一消息类型、多种渠道，支持按比例分流，采用加权随机算法实现。")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("h3",{attrs:{id:"_5-3-数据模型设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-数据模型设计"}},[_._v("#")]),_._v(" 5.3 数据模型设计")]),_._v(" "),t("ul",[t("li",[_._v("crm_user_toutch_tash：用户触达任务表")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("字段")]),_._v(" "),t("th",[_._v("数据类型")]),_._v(" "),t("th",[_._v("描述")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("id")]),_._v(" "),t("td",[_._v("bigint")]),_._v(" "),t("td",[_._v("主键")])]),_._v(" "),t("tr",[t("td",[_._v("task_no")]),_._v(" "),t("td",[_._v("bigint")]),_._v(" "),t("td",[_._v("任务编号")])]),_._v(" "),t("tr",[t("td",[_._v("comment")]),_._v(" "),t("td",[_._v("varchar")]),_._v(" "),t("td",[_._v("描述")])]),_._v(" "),t("tr",[t("td",[_._v("……")]),_._v(" "),t("td"),_._v(" "),t("td")])])]),_._v(" "),t("h3",{attrs:{id:"_5-4-接口设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-接口设计"}},[_._v("#")]),_._v(" 5.4 接口设计")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("接口名称")]),_._v(" "),t("th",[_._v("添加支付任务")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("接口文档地址")]),_._v(" "),t("td",[_._v("https://yapi.comn/xxx")])]),_._v(" "),t("tr",[t("td",[_._v("入参")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[_._v("入参描述")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[_._v("出参")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[_._v("出参描述")]),_._v(" "),t("td")])])]),_._v(" "),t("h3",{attrs:{id:"_5-5-异常处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-异常处理"}},[_._v("#")]),_._v(" 5.5 异常处理")]),_._v(" "),t("ul",[t("li",[_._v('系统中的不确定异常，进行统一处理，响应"Network Error"')]),_._v(" "),t("li",[_._v("埋点异步发送，不影响主要功能\n_ ……")])]),_._v(" "),t("blockquote",[t("p",[_._v("异常处理也是需要考虑的地方，哪些异常可以吞掉，哪些异常需要降级，怎么到日志等。")])]),_._v(" "),t("h2",{attrs:{id:"_6-风险评估"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-风险评估"}},[_._v("#")]),_._v(" 6. 风险评估")]),_._v(" "),t("h3",{attrs:{id:"_6-1-已知风险"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-已知风险"}},[_._v("#")]),_._v(" 6.1 已知风险")]),_._v(" "),t("ul",[t("li",[_._v("对数据相关服务压力较大，用户分群、用户画像等数据服务崩溃风险")]),_._v(" "),t("li",[_._v("MQ 存在堆积风险，导致用户收到消息延迟")]),_._v(" "),t("li",[_._v("QPS 较高，数据库 CPU 飙升风险")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("h3",{attrs:{id:"_6-2-可能风险"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-可能风险"}},[_._v("#")]),_._v(" 6.2 可能风险")]),_._v(" "),t("ul",[t("li",[_._v("场景类消息延迟，可能会影响交易相关流程，拉低转化率和成交率")]),_._v(" "),t("li",[_._v("……")])]),_._v(" "),t("h2",{attrs:{id:"_7-测试建议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-测试建议"}},[_._v("#")]),_._v(" 7. 测试建议")]),_._v(" "),t("blockquote",[t("p",[_._v("需求评审、设计阶段，都需要拉上测试同学，测试同学要对整体功能、性能，有比较清楚的了解。由于具体实现逻辑，开发会比较清楚，因此需要给测试同学一些建议，给测试的测试用例提供参考。")])]),_._v(" "),t("h3",{attrs:{id:"_7-1-功能测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-功能测试"}},[_._v("#")]),_._v(" 7.1 功能测试")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("功能")]),_._v(" "),t("th",[_._v("测试步骤")]),_._v(" "),t("th",[_._v("预期结果")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("定时消息发送")]),_._v(" "),t("td",[_._v("创建定时消息")]),_._v(" "),t("td",[_._v("消息定时发送")])]),_._v(" "),t("tr",[t("td",[_._v("……")]),_._v(" "),t("td"),_._v(" "),t("td")])])]),_._v(" "),t("h3",{attrs:{id:"_7-2-性能测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-性能测试"}},[_._v("#")]),_._v(" 7.2 性能测试")]),_._v(" "),t("ul",[t("li",[_._v("xxx接口压测，预估单机 QPS 1000。")])]),_._v(" "),t("h2",{attrs:{id:"_8-上线准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-上线准备"}},[_._v("#")]),_._v(" 8. 上线准备")]),_._v(" "),t("ul",[t("li",[_._v("运维搭建环境")]),_._v(" "),t("li",[_._v("数据初始化")]),_._v(" "),t("li",[_._v("添加配置")]),_._v(" "),t("li",[_._v("消息队列创建")]),_._v(" "),t("li",[_._v("依赖服务上线")]),_._v(" "),t("li",[_._v("服务上线")])]),_._v(" "),t("h2",{attrs:{id:"_9-评审意见"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-评审意见"}},[_._v("#")]),_._v(" 9. 评审意见")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("评审意见")]),_._v(" "),t("th",[_._v("提出人")]),_._v(" "),t("th",[_._v("提出日期")]),_._v(" "),t("th",[_._v("解决意见")]),_._v(" "),t("th",[_._v("解决人")]),_._v(" "),t("th",[_._v("解决日期")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("xxx接口需要考虑一下兼容性，建议xx字段，从object改为list")]),_._v(" "),t("td",[t("code",[_._v("@李四")])]),_._v(" "),t("td",[_._v("2023-01-02")]),_._v(" "),t("td",[_._v("修改字段类型")]),_._v(" "),t("td",[t("code",[_._v("@张三")])]),_._v(" "),t("td",[_._v("2023-02-01")])]),_._v(" "),t("tr",[t("td",[_._v("……")]),_._v(" "),t("td"),_._v(" "),t("td"),_._v(" "),t("td"),_._v(" "),t("td"),_._v(" "),t("td")])])])])}),[],!1,null,null,null);v.default=r.exports}}]);