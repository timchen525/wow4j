(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{508:function(e,a,t){"use strict";t.r(a);var s=t(19),n=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("MySQL  建表规范（补充版）")]),e._v(" "),t("h2",{attrs:{id:"_1-添加必要的冗余字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加必要的冗余字段"}},[e._v("#")]),e._v(" 1. 添加必要的冗余字段")]),e._v(" "),t("p",[e._v("除了默认的业务表，额外必添加以下6个字段：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("id")]),e._v(" "),t("strong",[e._v("主键id")])])]),e._v(" "),t("blockquote",[t("p",[e._v("** "),t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("`id` BIGINT UNSIGNED NOT NULL COMMENT \"主键i\",\nPRIMARY KEY('id')\n")])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：**")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Long")]),e._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("version")]),e._v(" "),t("strong",[e._v("版本号")])])]),e._v(" "),t("blockquote",[t("ul",[t("li",[t("ul",[t("li",[t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])])])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('`version` INT UNSIGNED NOT NULL DEFAULT 1 COMMENT "版本号",` \n')])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：**")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Integer")]),e._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("deleted")]),e._v(" "),t("strong",[e._v("删除标记（逻辑删除")]),e._v("） =>  对用户透明")])]),e._v(" "),t("blockquote",[t("p",[e._v("** "),t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])]),e._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TINYINT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("UNSIGNED")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("NOT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("NULL")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DEFAULT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COMMENT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"逻辑删除 0=>未删除  1=>删除"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：**")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Integer")]),e._v(" deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("user_id_update")]),e._v(" "),t("strong",[e._v("更新人")])])]),e._v(" "),t("blockquote",[t("p",[e._v("** "),t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])]),e._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("user_id_update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("CHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("36")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("NOT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("NULL")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COMMENT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"更新人id"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),e._v(" userIdUpdate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("time_update")]),e._v(" "),t("strong",[e._v("更新时间")])])]),e._v(" "),t("blockquote",[t("p",[e._v("** "),t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])]),e._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("time_update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("BIGINT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("UNSIGNED")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("NOT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("NULL")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DEFAULT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("CURRENT_TIMESTAMP")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COMMENT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"更新时间戳"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：**")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Long")]),e._v(" timeUpdate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("user_id_create")]),e._v(" "),t("strong",[e._v("创建人")])])]),e._v(" "),t("blockquote",[t("p",[e._v("** "),t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])]),e._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("user_id_create\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("CHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("36")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("NOT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("NULL")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COMMENT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"创建人"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：**")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),e._v(" userIdCreate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("time_create")]),e._v(" "),t("strong",[e._v("创建时间")])])]),e._v(" "),t("blockquote",[t("p",[e._v("** "),t("code",[e._v("MySQL")]),e._v("  数据库格式：**")])]),e._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("time_create"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("BIGINT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("UNSIGNED")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("NOT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("NULL")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DEFAULT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("CURRENT_TIMESTAMP")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COMMENT")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"创建时间戳"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),t("p",[e._v("** "),t("code",[e._v("Java")]),e._v(" 代码格式：**")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Long")]),e._v(" timeCreate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("根据上述的字段规范，Demo 如下：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('------------------------------------------\n-- 创建 user 表\n------------------------------------------\nDROP TABLE IF EXISTS user;\nCREATE TABLE user\n(\n `id` BIGINT UNSIGNED NOT NULL COMMENT "主键id",\n `name` VARCHAR(255) NOT NULL COMMENT "姓名",\n `age` TINYINT UNSIGNED COMMENT \'年龄\',\n `version` INT UNSIGNED NOT NULL DEFAULT 1 COMMENT "版本号",\n `deleted` TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT "逻辑删除 0=>未删除  1=>删除",\n `user_id_update` CHAR(36) NOT NULL COMMENT "更新人id",\n `time_update` BIGINT UNSIGNED NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT "更新时间戳",\n `user_id_create` CHAR(36) NOT NULL COMMENT "创建人",\n `time_create` BIGINT UNSIGNED NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT "创建时间戳",\nPRIMARY KEY(`id`)\n)engine=innodb default charset=utf8 COMMENT "用户表";\n')])])]),t("h2",{attrs:{id:"_2-基于mybatis-plus-的冗余字段设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-基于mybatis-plus-的冗余字段设置"}},[e._v("#")]),e._v(" 2. 基于MyBatis-Plus 的冗余字段设置")]),e._v(" "),t("p",[e._v("MyBatis-Plus 的官方地址：https://baomidou.com/guide/#%E7%89%B9%E6%80%A7")]),e._v(" "),t("h3",{attrs:{id:"_2-1-配置定义-id-生成器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-配置定义-id-生成器"}},[e._v("#")]),e._v(" 2.1 配置定义 ID 生成器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('/**\n * MyBatis-plus 配置 自定义 ID 生成器\n *\n * @author chenjintian\n */\n@Component\n@Slf4j\npublic class CustomIdGenerator implements IdentifierGenerator {\n  private LeafSnowflakeApiWrapper leafSnowflakeApiWrapper;\n  \n  @Autowired\n  public CustomIdGenerator (LeafSnowflakeApiWrapper leafSnowflakeApiWrapper) {\n     this.leafSnowflakeApiWrapper = leafSnowflakeApiWrapper;\n  }\n  @Override\n  public Number nextId(Object entity) {\n    long id = leafSnowflakeApiWrapper.getId();\n    if (log.isDebugEnabled()) {\n        log.debug("CustomIdGenerator id:{}.", id);\n    }\n    return id;\n  }\n}\n\npublic class User {\n  /**\n  * 对应数据库的主键id\n  */\n  @TableId(type = IdType.ASSIGN_ID)\n  private Long id;\n}\n')])])]),t("h3",{attrs:{id:"_2-2-配置乐观锁和分页插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置乐观锁和分页插件"}},[e._v("#")]),e._v(" 2.2 配置乐观锁和分页插件")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('@MapperScan("com.ip.profile.service.dao.mapper")\n@EnableTransactionManagement\n@Configuration\npublic class MyBatisPlusConfig {\n  // 注册乐观锁插件\n  @Bean\n  public OptimisticLockerInterceptor optimisticLockerInterceptor() {\n    return new OptimisticLockerInterceptor();\n  }\n\n  // 分页插件\n  @Bean\n  public PaginationInterceptor paginationInterceptor() {\n    PaginationInterceptor paginationInterceptor = new PaginationInterceptor();\n    // 设置单页最大的条数为500条\n    paginationInterceptor.setLimit(500);\n    return paginationInterceptor;\n  }\n}\n\npublic class User {\n   /**\n  * 版本号（乐观锁） =》对用户透明\n   */\n  @Version\n   private Integer version;\n}\n')])])]),t("h3",{attrs:{id:"_2-3-配置-更新人、更新时间、创建人、创建时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-配置-更新人、更新时间、创建人、创建时间"}},[e._v("#")]),e._v(" 2.3  配置 更新人、更新时间、创建人、创建时间")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('@Slf4j\n@Component\npublic class MyMetaObjectHandler implements MetaObjectHandler {\n\n    // 插入时的填充策略\n    @Override\n    public void insertFill(MetaObject metaObject) {\n        if (log.isDebugEnabled()) {\n            log.debug("start insert fill ...");\n        }\n\n        long currentTimeStamp = System.currentTimeMillis();\n        this.setFieldValByName("userIdCreate", UserUtil.getCurrentUserId(), metaObject);\n        this.setFieldValByName("timeCreate", currentTimeStamp, metaObject);\n        this.setFieldValByName("userIdUpdate", UserUtil.getCurrentUserId(), metaObject);\n        this.setFieldValByName("timeUpdate", currentTimeStamp, metaObject);\n\n        if (log.isDebugEnabled()) {\n            log.debug("end insert fill, userIdCreate:{}, timeCreate:{}, userIdUpdate:{}, timeUpdate:{}.",\n                    UserUtil.getCurrentUserId(), currentTimeStamp, UserUtil.getCurrentUserId(), currentTimeStamp);\n        }\n    }\n\n    // 更新时的填充策略\n    @Override\n    public void updateFill(MetaObject metaObject) {\n        if (log.isDebugEnabled()) {\n            log.debug("start update fill ...");\n        }\n\n        long currentTimeStamp = System.currentTimeMillis();\n        this.setFieldValByName("userIdUpdate", UserUtil.getCurrentUserId(), metaObject);\n        this.setFieldValByName("timeUpdate", currentTimeStamp, metaObject);\n\n        if (log.isDebugEnabled()) {\n            log.debug("end update fill, userIdUpdate:{}, timeUpdate:{}.", UserUtil.getCurrentUserId(), currentTimeStamp);\n        }\n    }\n}\n\npublic class User {\n\t/**\n\t * 更新人 ID\n\t */\n\t@TableField(fill = FieldFill.INSERT_UPDATE)\n\tprivate String userIdUpdate;\n\n\t/**\n\t * 更新时间（自动填充）=》对用户透明\n\t */\n\t@TableField(fill = FieldFill.INSERT_UPDATE)\n\tprivate Long timeUpdate;\n\n\t/**\n\t * 创建人 ID\n\t */\n\t@TableField(fill = FieldFill.INSERT)\n\tprivate String userIdCreate;\n\n\t/**\n\t * 创建时间（自动填充）=》对用户透明\n\t */\n\t@TableField(fill = FieldFill.INSERT)\n\tprivate Long timeCreate;\n}\n')])])]),t("h3",{attrs:{id:"_2-4-配置逻辑删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-配置逻辑删除"}},[e._v("#")]),e._v(" 2.4 配置逻辑删除")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 逻辑删除\nmybatis-plus.global-config.db-config.logic-delete-field=deleted\nmybatis-plus.global-config.db-config.logic-delete-value=1\nmybatis-plus.global-config.db-config.logic-not-delete-value=0\n\npublic class User {\n  /**\n  * 删除标记（逻辑删除）=> 对用户透明\n  */\n  @TableLogic\n  private Integer deleted;\n}\n")])])]),t("h2",{attrs:{id:"_3-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-总结"}},[e._v("#")]),e._v(" 3.  总结")]),e._v(" "),t("p",[e._v("MyBatis-Plus 帮助开发人员创建主键id，版本号，以及插入时的填充内容（更新人、更新时间、创建人、创建时间），这些工作MyBatis-Plus自动完成，极大的节"),t("strong",[e._v("省开发人员的时间")]),e._v("，而且代码会更规范。")]),e._v(" "),t("p",[t("strong",[e._v("补充：添加的Maven的依赖如下：")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\x3c!-- MySQL 驱动 + MyBatis-Plus --\x3e\n<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n</dependency>\n<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>mybatis-plus-boot-starter</artifactId>\n    <version>3.3.1</version>\n</dependency>\n<dependency>\n    <groupId>p6spy</groupId>\n    <artifactId>p6spy</artifactId>\n    <version>3.9.1</version>\n</dependency>\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);